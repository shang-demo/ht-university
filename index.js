(()=>{"use strict";var e={87:e=>{e.exports=require("os")}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("promise-retry");var t=r.n(e);const o=require("path");var n=r.n(o);const a=require("puppeteer-core");var i=r.n(a);let s;!function(e){e.OperationalError="OperationalError",e.SpawnError="spawn error",e.Timeout="Timeout",e.Unknown="Unknown",e.ParamsRequired="参数缺少",e.InjectNoPlatform="未选择平台",e.InjectNoServiceName="没有找到 service 文件",e.InjectNoModelName="没有找到 model 文件",e.InjectDuplicated="检测到相同字段",e.PathNotFound="路径未找到",e.PathIsNotDirectory="路径不是文件夹",e.LocalChromeNotFound="本机Chrome未找到"}(s||(s={}));class c extends Error{constructor(e,t,r="OperationalError"){super(),this.code=r,this.message=t||"OperationalError",this.extra=e}toJSON(){return{type:"error",message:this.message,code:this.code,extra:this.extra,stack:this.stack}}toString(){return`${this.code}\n${this.extra?JSON.stringify(this.extra):""}\n${this.stack||""}`}}const l=function(){const e=Object.keys(s).reduce(((e,t)=>{const r=s[t];return e[t]=class extends c{constructor(e,o){super(e,o||r,t)}},e}),{});return e.OperationalError=c,e}();const p=require("fs-extra");var u=r.n(p);const h=require("child_process"),m=/\r?\n/;function g(e){if(!e)return!1;try{return u().accessSync(e),!0}catch(t){return!1}}function w(e){const t=e?"google chrome canary":"google chrome",r=(0,h.execSync)(`/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -dump  | grep -i '${t}\\?.app$' | awk '{$1=""; print $0}'`).toString().split(m).filter((e=>e)).map((e=>e.trim()));r.unshift(e?"/Applications/Google Chrome Canary.app":"/Applications/Google Chrome.app");for(const o of r){if(o.startsWith("/Volumes"))continue;const t=n().join(o,e?"/Contents/MacOS/Google Chrome Canary":"/Contents/MacOS/Google Chrome");if(g(t))return t}}function f(){let e=[];[n().join(r(87).homedir(),".local/share/applications/"),"/usr/share/applications/"].forEach((t=>{e=e.concat(function(e){const t=/(^[^ ]+).*/,r="^Exec=/.*/(google-chrome|chrome|chromium)-.*",o=[];if(g(e)){let a;try{a=(0,h.execSync)(`grep -ER "${r}" ${e} | awk -F '=' '{print $2}'`)}catch(n){a=(0,h.execSync)(`grep -Er "${r}" ${e} | awk -F '=' '{print $2}'`)}a=a.toString().split(m).map((e=>e.replace(t,"$1"))),a.forEach((e=>g(e)&&o.push(e)))}return o}(t))}));if(["google-chrome-stable","google-chrome","chromium-browser","chromium"].forEach((t=>{try{const r=(0,h.execFileSync)("which",[t],{stdio:"pipe"}).toString().split(m)[0];g(r)&&e.push(r)}catch(r){}})),!e.length)throw new Error("The environment variable CHROME_PATH must be set to executable of a build of Chromium version 54.0 or later.");const t=[{regex:/chrome-wrapper$/,weight:51},{regex:/google-chrome-stable$/,weight:50},{regex:/google-chrome$/,weight:49},{regex:/chromium-browser$/,weight:48},{regex:/chromium$/,weight:47}];return process.env.CHROME_PATH&&t.unshift({regex:new RegExp(`${process.env.CHROME_PATH}`),weight:101}),function(e,t){return e.map((e=>{for(const r of t)if(r.regex.test(e))return{path:e,weight:r.weight};return{path:e,weight:10}})).sort(((e,t)=>t.weight-e.weight)).map((e=>e.path))}((o=e.filter(Boolean),Array.from(new Set(o))),t)[0];var o}function d(e){const t=e?`${n().sep}Google${n().sep}Chrome SxS${n().sep}Application${n().sep}chrome.exe`:`${n().sep}Google${n().sep}Chrome${n().sep}Application${n().sep}chrome.exe`;let r;return[process.env.LOCALAPPDATA,process.env.PROGRAMFILES,process.env["PROGRAMFILES(X86)"]].filter(Boolean).forEach((e=>{const o=n().join(e,t);g(o)&&(r=o)})),r}let y;async function x(){if(!y){const e=function(e={}){if(e.executablePath)return{executablePath:e.executablePath,type:"user"};const t=new Set(e.channel||["stable"]);let r;return(t.has("canary")||t.has("*"))&&("linux"===process.platform?r=f():"win32"===process.platform?r=d(!0):"darwin"===process.platform&&(r=w(!0)),r)?{executablePath:r,type:"canary"}:(t.has("stable")||t.has("*"))&&("linux"===process.platform?r=f():"win32"===process.platform?r=d():"darwin"===process.platform&&(r=w()),r)?{executablePath:r,type:"stable"}:void 0}();if(!e)throw new l.LocalChromeNotFound;const t=["--app=data:text/html,","--window-size=1000,600","--window-position=150,60"];y=i().launch({args:t,executablePath:e.executablePath,headless:!0,defaultViewport:null,pipe:!0,userDataDir:(0,o.resolve)(__dirname,"../../../.local-data/profile")})}return y}async function v(e,r,o){return t()(((t,o)=>(console.log("attempt number",o),async function(e,t){const r=await e.newPage();await r.goto(`http://university.hengtonggroup.com.cn/${t}`,{waitUntil:"networkidle2"}),await r.$eval("video",(e=>{let t=e;return new Promise(((e,o)=>{setTimeout((()=>{o(new Error("time out"))}),3e4),t.addEventListener("playing",(()=>{setTimeout(e,3e3)}),{once:!0}),t.addEventListener("ended",(()=>{setTimeout((()=>{r.close()}),3e3)}),{once:!0}),t.play(),t.muted=!0}))}))}(e,r).catch(t))),o)}(async()=>{console.log("启动浏览器中.....");const e=await x(),t=await e.newPage(),[r,o]=process.argv.slice(2);await async function(e,t,r){if(!e)throw new Error("请输入用户名");if(!t)throw new Error("请输入密码");return console.log("登录账户为: ",{username:e,password:t}),await r.goto("http://university.hengtonggroup.com.cn/login.htm",{waitUntil:"networkidle2"}),await r.waitForSelector("#txtUserName2"),await r.type("#txtUserName2",e,{delay:100}),await r.type("#txtPassword2",t,{delay:100}),console.log("登录中...."),await Promise.all([r.waitForNavigation({timeout:3e4,waitUntil:"networkidle2"}),await r.$eval("#btnLogin2",(e=>{e.click()}))]),r}(r,o,t);const n=await async function(e){var t;await e.goto("http://university.hengtonggroup.com.cn/sty/mystudytask.htm",{waitUntil:"networkidle2"});const r=await e.content(),[o]=null!==(t=r.match(/(?<=learningKnowledge\((&quot;|"))(.*?\.html)/g))&&void 0!==t?t:[];return await e.goto(`http://university.hengtonggroup.com.cn/${o}`,{waitUntil:"networkidle2"}),await e.$$eval("#tbodyTrainInfo .hand",(e=>e.filter((e=>{var t;let r=e.querySelector("td:last-of-type");if(!r)return!1;const[o]=null!==(t=r.innerText.match(/\d+(?=%)/))&&void 0!==t?t:[];return!!o&&100!==parseInt(o,10)})).map((e=>{var t;const[r]=null!==(t=e.outerHTML.match(/(?<=StudyRowClick\((&quot;|"|'))(.*?\.html)/g))&&void 0!==t?t:[];return r}))))}(t);console.log("正在打开网页做任务~, 共有任务: ",n.length);for(const a of n)await v(e,a,{retries:3});console.log("执行中, 没有结束判断, 等半小时自己 ctrl+c 关闭吧")})().catch(console.warn)})()})();
//# sourceMappingURL=index.js.map